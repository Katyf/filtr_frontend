"use strict";var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])};$(document).ajaxStart(function(a){trace(a,"starting an ajax request"),$("section#ajax-preloader").fadeIn(),$("section#container").fadeOut()}),$(document).ajaxComplete(function(){$("section#ajax-preloader").fadeOut(),$("section#container").fadeIn()});var App=function(a){a.initialize=function(){new k;Backbone.history.start(),$("#container").on("submit","form#comment-form",i),$("#container").on("submit","form#nested-comment-form",j)};var b=function(){trace("hello from home"),$("#container").empty(),$.ajax({url:"https://filter-api.herokuapp.com/posts"}).done(function(a){var b=a.reverse();console.log(b);for(var c=0;c<b.length;c++){b[c]}var d=Handlebars.compile($("#homeTemplate").html());$("#container").html(d({post:b}))}).fail(c)},c=function(a){console.log(a)},d=function(a){console.log(a)},e=function(a,b,e){var f=b.votes.length;$(".vote").empty(),$(".vote").append(b.votecount),$.ajax({url:"https://filter-api.herokuapp.com/posts/"+e+"/images/"+a.alt+"/upvote",type:"PATCH",data:{vote:{count:f}}}).done(d).fail(c)},f=function(a){{var b=a.data.postId,d=this.alt,f=this;$(".voteable")}$.ajax({url:"https://filter-api.herokuapp.com/posts/"+b+"/images/"+d,type:"GET"}).done(function(a){e(f,a,b)}).fail(c)},g=function(a){localStorage.setItem("id",a.id);var b=Handlebars.compile($("#showPostsTemplate").html());$("#container").html(b({onePost:a})),$("body").on("click","img.voteable",{postId:a.id},f),$("img.voteable").on("click",function(){var a=parseInt(localStorage.getItem("id"))+1;localStorage.setItem("id",a),console.log(a),h(a)}),$("#comment-form").hide(),$("#new-comment-btn").on("click",function(){$("#comment-form").show()}),$(".nested-comment-form").hide(),$(".add-nested-comment-btn").on("click",function(){$(".nested-comment-form").toggle()}),$("#button").on("click",function(a){a.preventDefault();var b=parseInt(localStorage.getItem("id"))+1;localStorage.setItem("id",b),console.log(b),h(b)})},h=function(a){trace("hello word from showPosts");var b=localStorage.getItem("id")||a;$.ajax({url:"https://filter-api.herokuapp.com/posts/"+b,type:"GET"}).done(g).fail(function(){$("#container").empty(),$("#container").append("Thanks for voting today, now <h2><a href='http://teamjkg.github.io/filtr_frontend/'>GO HOME</a></h2>"),localStorage.setItem("id",1)})},i=function(a){console.log("this is the submit form");var b=$(".show-post").data("post-id");a.preventDefault(),$.ajax({url:"https://filter-api.herokuapp.com/posts/"+b+"/comments",type:"POST",data:{comment:{user:$("input#comment-user").val(),body:$("textarea#comment-body").val()}}}).done(function(a){console.log(a),h()}).fail(function(a,b,c){console.log(a,b,c)})},j=function(a){console.log("this is a nested comment");var b=$(".show-post").data("post-id"),c=$(".comment").data("comment-id");a.preventDefault(),$.ajax({url:"http://filter-api.herokuapp.com/posts/"+b+"/comments"+c,type:"POST",data:{comment:{user:$("input#comment-user").val(),body:$("textarea#comment-body").val()}}}).done(function(a){console.log(a),h()}).fail(function(a,b,c){console.log(a,b,c)})},k=Backbone.Router.extend({routes:{"":"home",home:"home","posts/:id":"showPost"},home:b,showPost:h});return a}(App||{});$(document).ready(function(){App.initialize()});var filtrApp=function(){var a,b,c=function(){a=localStorage.getItem("authToken"),b="https://filter-api.herokuapp.com",g(),$("#signin-form").on("submit",f),$("#signup-form").on("submit",d),$("#sign-out").on("click",h)},d=function(a){return a.preventDefault(),$.ajax({url:b+"/users",type:"POST",data:{user:{email:$("#email").val(),username:$("#username").val(),password:$("#password").val()}}}).done(e).fail(function(){console.log("error")}),!1},e=function(a){localStorage.setItem("authToken",a.token),console.log("Logged in!"),window.location.href="/",console.log("Logged in!")},f=function(){var a;return event.preventDefault(),a=$(this),$.ajax({url:b+"/users/sign_in",type:"POST",data:a.serialize()}).done(e).fail(function(){console.log("error")}),!1},g=function(){$.ajaxPrefilter(function(b){b.headers={},b.headers.AUTHORIZATION="Token token="+a})},h=function(b){b.preventDefault(),localStorage.removeItem("authToken"),a=void 0,window.location.href="/signin.html"};return{init:c}}();$(document).ready(function(){filtrApp.init()}),$(document).ready(function(){$("#signup-form-div").hide(),$(".example").on("click",function(){window.location.href="http://teamjkg.github.io/filtr_frontend/"}),$(".item").on("click",function(){$(".item").toggleClass("active"),$(".bottom.attached.segment").toggle()}),$(".example").popup({hoverable:!0,position:"top center"})});var S3App=S3App||{};S3App.submitPost=function(){event.preventDefault(),$.ajax({url:"https://filter-api.herokuapp.com/posts",type:"POST",data:{post:{message:$("#post-msg").val()}}}).done(function(a){console.log(a.id),S3App.getKey(a.id),$("#new-post-form").hide(),S3App.getMessage(a.id),$("#message-prompt").hide()}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},S3App.getMessage=function(a){$.ajax({url:"https://filter-api.herokuapp.com/posts/"+a,type:"GET"}).done(function(a){S3App.renderMessage(a.message)}).fail(function(){console.log("error")})},S3App.renderMessage=function(a){$(".post-message-div").append("<h4>Your Message: </h4><p> "+a+"</p>")},S3App.getKey=function(a){$.ajax({url:"https://filter-api.herokuapp.com/amazon/sign_key",type:"GET",dataType:"JSON"}).done(function(b){$("#s3-container").fadeIn(),$("#img-upload-prompt").fadeIn();var c=Handlebars.compile($("#imageFormTemplate").html());$("#s3-container").html(c({imageForm:b})),console.log(b),$(".imageForm").on("submit",function(){S3App.sendUrlToDb(a,b.key)})}).fail(function(){console.log("error")})},S3App.sendUrlToDb=function(a,b){$.ajax({url:"https://filter-api.herokuapp.com/posts/"+a+"/images",type:"POST",data:{image:{url:"https://s3.amazonaws.com/filtrapp/"+b}}}).done(function(b){console.log(b),$("#s3-container").empty(),S3App.getSecondKey(a),$(".second.modal #next").on("click",function(){S3App.showThumbs(b.url)})}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},S3App.getSecondKey=function(a){$.ajax({url:"https://filter-api.herokuapp.com/amazon/sign_key",type:"GET",dataType:"JSON"}).done(function(b){$("#first-check").fadeIn("slow"),$("#first-check").transition({animation:"pulse",duration:"2s"}),$("#s3-container").fadeIn(),$("#img-upload-prompt-2").fadeIn();var c=Handlebars.compile($("#imageFormTemplate2").html());$("#s3-container").html(c({imageForm:b})),console.log(b),$(".imageForm").on("submit",function(){S3App.sendSecondUrlToDb(a,b.key)})}).fail(function(){console.log("error")})},S3App.sendSecondUrlToDb=function(a,b){$.ajax({url:"https://filter-api.herokuapp.com/posts/"+a+"/images",type:"POST",data:{image:{url:"https://s3.amazonaws.com/filtrapp/"+b}}}).done(function(a){console.log(a),$("#s3-container").fadeOut(),$("#second-check").fadeIn("slow"),$("#second-check").transition({animation:"pulse",duration:"2s"}),$("#done").fadeIn(),$(".second.modal #next").on("click",function(){S3App.showThumbs(a.url)})}).fail(function(){console.log("error")}).always(function(){console.log("complete")})},S3App.showThumbs=function(a){$("div#img-preview-container").append('<img class="show-img" src="'+a+'" style="width:100px;height:100px"/>')},$(document).ready(function(){$("#img-upload-prompt").hide(),$("#img-upload-prompt-2").hide(),$("#done").hide(),$(".checkmark").hide(),$("#new-post-form").on("submit",function(){console.log("submitted"),S3App.submitPost()}),$("#done").on("click",function(){window.location.href="http://teamjkg.github.io/filtr_frontend/"})}),$(document).ready(function(){$("#back").on("click",function(){window.location.href="http://teamjkg.github.io/filtr_frontend/#/posts/1"}),$("#clickme").on("click",function(){$(".coupled.modal").modal({allowMultiple:!1}),$(".third.modal").modal("attach events",".second.modal #next"),$(".second.modal").modal("attach events",".first.modal #next"),$(".first.modal").modal("show")})});