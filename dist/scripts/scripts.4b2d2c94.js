"use strict";var trace=function(){for(var a=0;a<arguments.length;a++)console.log(arguments[a])};$(document).ajaxStart(function(a){trace(a,"starting an ajax request"),$("section#ajax-preloader").fadeIn(),$("section#container").fadeOut()}),$(document).ajaxComplete(function(){$("section#ajax-preloader").fadeOut(),$("section#container").fadeIn()});var App=function(a){a.initialize=function(){new k;Backbone.history.start(),$("#container").on("submit","form#comment-form",i),$("#container").on("submit","form#nested-comment-form",j)};var b=function(){trace("hello from home"),$("#container").empty(),$.ajax({url:"https://filter-api.herokuapp.com/posts"}).done(function(a){var b=a.reverse();console.log(b);for(var c=0;c<b.length;c++){b[c]}var d=Handlebars.compile($("#homeTemplate").html());$("#container").html(d({post:b}))}).fail(c)},c=function(a){console.log(a)},d=function(a){console.log(a)},e=function(a,b,e){var f=b.votes.length;$(".vote").empty(),$(".vote").append(b.votecount),$.ajax({url:"https://filter-api.herokuapp.com/posts/"+e+"/images/"+a.alt+"/upvote",type:"PATCH",data:{vote:{count:f}}}).done(d).fail(c)},f=function(a){{var b=a.data.postId,d=this.alt,f=this;$(".voteable")}$.ajax({url:"https://filter-api.herokuapp.com/posts/"+b+"/images/"+d,type:"GET"}).done(function(a){e(f,a,b)}).fail(c)},g=function(a){localStorage.setItem("id",a.id);var b=Handlebars.compile($("#showPostsTemplate").html());$("#container").html(b({onePost:a})),$("body").on("click","img.voteable",{postId:a.id},f),$("img.voteable").on("click",function(){var a=parseInt(localStorage.getItem("id"))+1;localStorage.setItem("id",a),console.log(a),h(a)}),$("#comment-form").hide(),$("#new-comment-btn").on("click",function(){$("#comment-form").show()}),$(".nested-comment-form").hide(),$(".add-nested-comment-btn").on("click",function(){$(".nested-comment-form").toggle()}),$("#button").on("click",function(a){a.preventDefault();var b=parseInt(localStorage.getItem("id"))+1;localStorage.setItem("id",b),console.log(b),h(b)})},h=function(a){trace("hello word from showPosts");var b=localStorage.getItem("id")||a;$.ajax({url:"https://filter-api.herokuapp.com/posts/"+b,type:"GET"}).done(g).fail(function(){$("#container").empty(),$("#container").append("Thanks for voting today, now <h2><a href='http://teamjkg.github.io/filtrapp/'>GO HOME</a></h2>"),localStorage.setItem("id",1)})},i=function(a){console.log("this is the submit form");var b=$(".show-post").data("post-id");a.preventDefault(),$.ajax({url:"https://filter-api.herokuapp.com/posts/"+b+"/comments",type:"POST",data:{comment:{user:$("input#comment-user").val(),body:$("textarea#comment-body").val()}}}).done(function(a){console.log(a),h()}).fail(function(a,b,c){console.log(a,b,c)})},j=function(a){console.log("this is a nested comment");var b=$(".show-post").data("post-id"),c=$(".comment").data("comment-id");a.preventDefault(),$.ajax({url:"http://filter-api.herokuapp.com/posts/"+b+"/comments"+c,type:"POST",data:{comment:{user:$("input#comment-user").val(),body:$("textarea#comment-body").val()}}}).done(function(a){console.log(a),h()}).fail(function(a,b,c){console.log(a,b,c)})},k=Backbone.Router.extend({routes:{"":"home",home:"home","posts/:id":"showPost"},home:b,showPost:h});return a}(App||{});$(document).ready(function(){App.initialize()});var filtrApp=function(){var a,b,c=function(){a=localStorage.getItem("authToken"),b="https://filter-api.herokuapp.com",g(),$("#signin-form").on("submit",f),$("#signup-form").on("submit",d),$("#sign-out").on("click",h)},d=function(a){return a.preventDefault(),$.ajax({url:b+"/users",type:"POST",data:{user:{email:$("#email").val(),username:$("#username").val(),password:$("#password").val()}}}).done(e).fail(function(){console.log("error")}),!1},e=function(a){localStorage.setItem("authToken",a.token),console.log("Logged in!"),window.location.href="/",console.log("Logged in!")},f=function(){var a;return event.preventDefault(),a=$(this),$.ajax({url:b+"/users/sign_in",type:"POST",data:a.serialize()}).done(e).fail(function(){console.log("error")}),!1},g=function(){$.ajaxPrefilter(function(b){b.headers={},b.headers.AUTHORIZATION="Token token="+a})},h=function(b){b.preventDefault(),localStorage.removeItem("authToken"),a=void 0,window.location.href="/signin.html"};return{init:c}}();$(document).ready(function(){filtrApp.init()});